{% extends 'base.html' %}
{% block title %}Mini-X | Detalle Post{% endblock %}

{% block content %}
<h1>Detalle del Post</h1>
<div style="border-bottom:1px solid #ccc; padding:10px;">
    <a href="{% url 'perfil' post.usuario.pk %}"><p><strong>@{{ post.usuario.username }}</strong></p></a>
    <p>{{ post.contenido }}</p>
    <p>{{ post.created_at|date:"H:i d/m/Y" }}</p>

    <form action="{% url 'like_post_detalle' post.pk %}" method="post">
        {% csrf_token %}
        {% if user in post.likes.all %}
            <button class="btn btn-primary btn-sm" type="submit">
                ❤️ {{ post.total_likes }}
            </button>
        {% else %}
            <button class="btn btn-light btn-sm" type="submit">
                ❤️ {{ post.total_likes }}
            </button>
        {% endif %}
    </form>
</div>

<h3>Comentarios</h3>

{% for comentario in comentarios %}
    <div style="border-bottom:1px solid #ccc; padding:10px;">
        <a href="{% url 'perfil' comentario.usuario.pk %}"><p><strong>@{{ comentario.usuario.username }}</strong></p></a>
        <p>{{ comentario.contenido }}</p>
        <p>{{ comentario.created_at|date:"H:i d/m/Y" }}</p>
    </div>
{% empty %}
    <p>No hay comentarios aún.</p>
{% endfor %}
<h3>Agregar Comentario</h3>
{% if user.is_authenticated %}
<form method="POST">
    {% csrf_token %}
    <textarea name="contenido" rows="3" cols="40" required></textarea><br>
    <button type="submit">Comentar</button>
</form>
{% else %}
<p>Debes <a href="{% url 'login' %}">iniciar sesión</a> para comentar.</p>
{% endif %}

{% if user.is_authenticated and user == post.usuario %}
    <a href="{% url 'editar_post' post.pk %}">Editar</a>
    <a href="{% url 'eliminar_post' post.pk %}">Eliminar</a>
{% endif %}
{% endblock %}